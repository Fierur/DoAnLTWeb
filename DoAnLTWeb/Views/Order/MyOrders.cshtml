@model IEnumerable<DoAnLTWeb.Models.DonDatHang>
@{
    ViewBag.Title = "Đơn hàng của tôi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
body {
    font-family: 'Roboto', Arial, sans-serif;
    background-color: #f5f5f5;
}

h2 {
    font-weight: 600;
    color: #333;
}

.table {
    background: #fff;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.table thead {
    background-color: #f8f8f8;
    font-weight: 600;
    color: #333;
}

.table tbody tr:hover {
    background-color: #fff2f2;
}

.table td, .table th {
    vertical-align: middle;
}

.btn-info {
    background-color: #2196f3 !important;
    border-color: #2196f3 !important;
    font-size: 13px;
    padding: 5px 10px;
    transition: 0.3s;
}

.btn-info:hover {
    background-color: #1976d2 !important;
}

    .status {
        display: inline-flex;
        align-items: center;
        gap: 6px; 
        padding: 4px 10px;
        border-radius: 20px;
        color: #fff;
        font-weight: 500;
        font-size: 13px;
    }

.status-1001 { background-color: #ff9800; } /* Chờ xác nhận - cam */
.status-1002 { background-color: #2196f3; } /* Đang giao - xanh dương */
.status-1003 { background-color: #4caf50; } /* Hoàn tất - xanh lá */
.status-1004 { background-color: #f44336; } /* Đã hủy - đỏ */

/* RESPONSIVE */
@@media (max-width: 768px) {
    .table {
        font-size: 13px;
    }
    .btn-info {
        padding: 4px 8px;
        font-size: 12px;
    }
}

</style>
<h2 class="text-center mt-4">Đơn hàng của tôi</h2>

@if (!Model.Any())
{
    <p class="text-center text-muted mt-3">Bạn chưa có đơn hàng nào.</p>
}
else
{
<table class="table table-hover mt-4">
    <thead class="table-light">
        <tr>
            <th>Mã đơn</th>
            <th>Ngày đặt</th>
            <th>Tổng tiền</th>
            <th>Trạng thái</th>
            <th></th>
        </tr>
    </thead>
    @*<tbody>
            @foreach (var don in Model)
            {
                var tt = don.ChiTietTrangThais.OrderByDescending(t => t.NgayCapNhatTT).FirstOrDefault();
                <tr>
                    <td>@don.MaDon</td>
                    <td>
                        @(don.NgayDat.HasValue ? don.NgayDat.Value.ToString("dd/MM/yyyy") : "")
                    </td>
                    <td>@String.Format("{0:N0} đ", don.TongTien)</td>
                    <td>@(tt?.TrangThai?.TenTT ?? "Đang giao")</td>
                    <td>
                        @Html.ActionLink("Chi tiết", "OrderDetail", "Order", new { id = don.MaDon }, new { @class = "btn btn-sm btn-info" })
                    </td>
                </tr>
            }
        </tbody>*@
<tbody>
    @foreach (var don in Model)
    {
        var tt = don.ChiTietTrangThais.OrderByDescending(t => t.NgayCapNhatTT).FirstOrDefault();
        var trangThai = tt?.TrangThai;
        string statusClass = "";
        string statusIcon = "";
        switch (trangThai?.MaTT)
        {
            case 1001: statusClass = "status-1001"; statusIcon = "fa-clock"; break;
            case 1002: statusClass = "status-1002"; statusIcon = "fa-truck"; break;
            case 1003: statusClass = "status-1003"; statusIcon = "fa-check-circle"; break;
            case 1004: statusClass = "status-1004"; statusIcon = "fa-times-circle"; break;
            default: statusClass = "status-1001"; statusIcon = "fa-clock"; break;
        }
        <tr>
            <td>@don.MaDon</td>
            <td>@(don.NgayDat.HasValue ? don.NgayDat.Value.ToString("dd/MM/yyyy") : "")</td>
            <td>@String.Format("{0:N0} đ", don.TongTien)</td>
            <td>
                <span class="status @statusClass">
                    <i class="fa @statusIcon"></i>
                    @((trangThai?.TenTT) ?? "Đang giao")
                </span>
            </td>
            <td>
                @Html.ActionLink("Chi tiết", "OrderDetail", "Order", new { id = don.MaDon }, new { @class = "btn btn-sm btn-info" })
            </td>
        </tr>
    }
</tbody>
</table>
}
